<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title default="GreenManTavern" suffix=" · Phoenix Framework">
      {assigns[:page_title]}
    </.live_title>
    <link phx-track-static rel="stylesheet" href={~p"/assets/css/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}>
    </script>
    <script>
      (() => {
        const setTheme = (theme) => {
          if (theme === "system") {
            localStorage.removeItem("phx:theme");
            document.documentElement.removeAttribute("data-theme");
          } else {
            localStorage.setItem("phx:theme", theme);
            document.documentElement.setAttribute("data-theme", theme);
          }
        };
        if (!document.documentElement.hasAttribute("data-theme")) {
          setTheme(localStorage.getItem("phx:theme") || "system");
        }
        window.addEventListener("storage", (e) => e.key === "phx:theme" && setTheme(e.newValue || "system"));
        
        window.addEventListener("phx:set-theme", (e) => setTheme(e.target.dataset.phxTheme));
        
        // Characters dropdown functionality
        document.addEventListener("click", function(event) {
          const dropdown = document.getElementById("characters-dropdown");
          const dropdownContainer = event.target.closest(".dropdown-container");
          
          if (dropdownContainer) {
            // Clicked inside dropdown container
            if (event.target.classList.contains("dropdown-button")) {
              // Toggle dropdown
              dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
            }
          } else {
            // Clicked outside dropdown - close it
            if (dropdown) {
              dropdown.style.display = "none";
            }
          }
        });
      })();
    </script>
  </head>
  <body>
    <div class="master-layout">
      <.banner_menu current_character={assigns[:character]} current_user={assigns[:current_user]} />
      <div class="content-container">
        <div class="left-window">
          <div class="mac-title-bar">
            <div class="mac-close-box">×</div>
            <span class="mac-window-title">{assigns[:left_window_title] || "Tavern"}</span>
          </div>
          
          <div class="mac-window-content">
            <!-- Always show tavern image -->
            <div style="margin-bottom: 12px;">
              <img src="/images/the_tavern.png" alt="Green Man Tavern" style="width: 100%; display: block; border: 1px solid #000;" />
            </div>
            
            <!-- Show character content if character is selected, auth pages, or default message -->
            <%= if assigns[:character] do %>
              <!-- Character content will be rendered here by the LiveView -->
              {@inner_content}
            <% else %>
              <!-- For auth pages or other content, just render the inner content -->
              {@inner_content}
            <% end %>
          </div>
        </div>
        <div class="right-window">
          <div class="mac-title-bar">
            <div class="mac-close-box">×</div>
            <span class="mac-window-title">{assigns[:right_window_title] || "Main"}</span>
          </div>
          <div class="mac-window-content">
            <%= if assigns[:character] do %>
              <!-- Right window content - shows results/consequences of character interactions -->
              <div style="padding: 16px;">
                <h2 style="font-family: Chicago, 'Arial Black', sans-serif; font-size: 18px; margin-bottom: 12px;">
                  Interaction Results
                </h2>
                
                <div style="border: 1px solid #CCC; padding: 12px; background: #F9F9F9;">
                  <p style="font-size: 12px; color: #666; margin-bottom: 8px;">
                    Chat with <%= assigns[:character].name %> in the left window to see results here.
                  </p>
                  <p style="font-size: 11px; color: #999;">
                    This area will show:
                  </p>
                  <ul style="font-size: 11px; color: #666; margin-left: 16px; margin-top: 4px;">
                    <li>Living Web updates (new systems suggested)</li>
                    <li>Garden recommendations</li>
                    <li>Database entries</li>
                    <li>Quest notifications</li>
                  </ul>
                </div>
              </div>
            <% else %>
              <!-- Default right window content -->
              <div style="padding: 16px;">
                <h2 style="font-family: Chicago, 'Arial Black', sans-serif; font-size: 18px; margin-bottom: 12px;">
                  Welcome
                </h2>
                <p style="font-size: 12px; color: #666;">
                  Select a character to begin your permaculture journey.
                </p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
